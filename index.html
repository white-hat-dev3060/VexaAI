<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vexa AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
html, body {height:100%;margin:0;font-family:Inter,sans-serif;transition:background 0.3s,color 0.3s;}
.dark {background:#1E1E1E;color:#fff;}
.bg-white{background:#f9f9f9;}
textarea:focus {outline:none;}
.loader {border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.scrollbtn {position:absolute;right:20px;bottom:80px;padding:8px;border-radius:999px;background:#3498db;color:#fff;display:none;}
</style>
</head>
<body class="bg-white">

<div id="namePrompt" class="fixed inset-0 flex items-center justify-center bg-white dark:bg-[#1E1E1E] z-50">
  <div class="p-6 bg-gray-100 dark:bg-gray-800 rounded-xl shadow-lg w-80 text-center">
    <h2 class="text-lg font-semibold mb-4">Welcome to Vexa AI</h2>
    <input id="userNameInput" type="text" placeholder="Enter your name" class="w-full p-3 rounded-lg mb-4 dark:bg-gray-700">
    <button onclick="saveName()" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">Start Chat</button>
  </div>
</div>

<div id="app" class="hidden h-full flex flex-col">
  <div class="flex-1 overflow-y-auto p-4" id="messagesContainer"></div>

  <div class="p-4 bg-gray-100 dark:bg-[#2A2A2A] flex items-center gap-2">
    <textarea id="promptInput" rows="1" placeholder="Ask anything..." class="flex-1 p-3 rounded-xl dark:bg-gray-700"></textarea>
    <button onclick="sendMessage()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Send</button>
  </div>

  <button id="scrollBtn" class="scrollbtn" onclick="scrollToBottom()">â†“</button>
  <button onclick="toggleDarkMode()" class="fixed top-4 right-4 bg-gray-300 dark:bg-gray-700 p-2 rounded-lg">ðŸŒ“</button>
</div>

<script>
let userName = "";
const backendURL = "https://tlkytdfh9pbtbwj0.public.blob.vercel-storage.com/api.js";

const state = { messages: [] };

function saveName(){
  const input = document.getElementById("userNameInput").value.trim();
  if(!input) return alert("Please enter a name!");
  userName = input;
  document.getElementById("namePrompt").style.display = "none";
  document.getElementById("app").classList.remove("hidden");
  addMessage("system", `Hello ${userName}, I am Vexa AI. How can I help you today?`);
}

function addMessage(role, text){
  state.messages.push({role,text});
  renderMessages();
}

function renderMessages(){
  const container = document.getElementById("messagesContainer");
  container.innerHTML = "";
  state.messages.forEach(msg=>{
    const div = document.createElement("div");
    div.className = "mb-3";
    if(msg.role==="user") div.innerHTML=`<div class="text-right"><span class="inline-block bg-blue-100 dark:bg-blue-900 p-2 rounded-xl">${msg.text}</span></div>`;
    else div.innerHTML=`<div class="text-left"><span class="inline-block bg-gray-200 dark:bg-gray-700 p-2 rounded-xl">${msg.text}</span></div>`;
    container.appendChild(div);
  });
  scrollToBottom();
}

async function sendMessage(){
  const input = document.getElementById("promptInput");
  const text = input.value.trim();
  if(!text) return;
  input.value="";
  addMessage("user", text);

  const loader = document.createElement("div");
  loader.className="loader mb-3";
  document.getElementById("messagesContainer").appendChild(loader);
  scrollToBottom();

  try{
    const res = await fetch(backendURL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text})
    });
    const data = await res.json();
    addMessage("assistant", data.reply || "Sorry, no response");
  } catch(err){
    addMessage("assistant","Error connecting to backend");
  }
  loader.remove();
}

function scrollToBottom(){
  const c = document.getElementById("messagesContainer");
  c.scrollTop = c.scrollHeight;
}

function toggleDarkMode(){
  document.body.classList.toggle("dark");
}
</script>
</body>
  </html>
